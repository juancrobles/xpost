% Type 3 font handling

(loading font.ps\n)print

/definefont {
    dup type /dicttype ne
    2 index type /nametype ne or {
        /definefont cvx /typecheck signalerror
    } if
    {
        dup /FontMatrix known not {stopped} if
        dup /FontType known not {stopped} if
        dup /FontMatrix known not {stopped} if
        dup /Encoding known not {stopped} if
        dup /BuildChar known not {stopped} if
    } stopped {
        /definefont cvx /invalidfont signalerror
    } if
    dup /FontName 3 index put
    FontDirectory exch 2 index exch put
    findfont
} def

/scalefont {
    1 index /FontType get 3 ne { //scalefont }{
        dup matrix scale makefont
    } ifelse
} def

/makefont {
    1 index /FontType get 3 ne { //makefont }{
        1 index /FontMatrix get dup concatmatrix pop
    } ifelse
} def

/setcharwidth {
    graphicsdict /currgstate get /currfont get
    dup /xadvance 5 4 roll put
    /yadvance 3 2 roll put
} def

/setcachedevice {
    pop pop pop pop
    setcharwidth
} def

/show {
    graphicsdict /currgstate get /currfont get
    dup /FontType get 3 ne { pop //show }{
    gsave
        currentpoint translate
        newpath
        dup /FontMatrix get concat
        exch
        %pstack()=
        {
            gsave
                1 index /BuildChar get exec
            grestore
            graphicsdict /currgstate get /currfont get
            dup /xadvance get 1 index /yadvance get
            translate
            %hook
        } forall
        pop
    grestore

    } ifelse
} def

/widthshow {
    graphicsdict /currgstate get /currfont get
    dup /FontType get 3 ne {
        pop
        4 2 roll dtransform
        4 2 roll
        //widthshow
    }{
    5 2 roll
    3 dict begin
    {charcode cy cx}{exch def}forall
    gsave
        currentpoint translate
        newpath
        dup /FontMatrix get
        dup concat
        cx cy 3 2 roll dtransform /cy exch def /cx exch def
        exch
        %pstack()=
        {
            dup /curcode exch def
            gsave
                1 index /BuildChar get exec
            grestore
            graphicsdict /currgstate get /currfont get
            dup /xadvance get 1 index /yadvance get
            translate
            curcode charcode eq {
                cx cy translate
            } if
            %hook
        } forall
        pop
    grestore
    end

    } ifelse
} def

/ashow {
    graphicsdict /currgstate get /currfont get
    dup /FontType get 3 ne {
        pop
        3 1 roll dtransform
        3 2 roll
        //ashow
    }{
    4 2 roll
    2 dict begin
    {dy dx}{exch def}forall
    gsave
        currentpoint translate
        newpath
        dup /FontMatrix get
        dup concat
        dx dy 3 2 roll dtransform /dy exch def /dx exch def
        exch
        %pstack()=
        {
            gsave
                1 index /BuildChar get exec
            grestore
            graphicsdict /currgstate get /currfont get
            dup /xadvance get 1 index /yadvance get
            translate
            dx dy translate
            %hook
        } forall
        pop
    grestore
    end

    } ifelse
} def

/awidthshow {
    graphicsdict /currgstate get /currfont get
    dup /FontType get 3 ne {
        pop
        5 1 roll dtransform
        5 3 roll dtransform
        5 2 roll
        //awidthshow
    }{
    7 2 roll
    5 dict begin
    {charcode cy cx dy dx}{exch def}forall
    gsave
        currentpoint translate
        newpath
        dup /FontMatrix get
        dup concat
        dup dx dy 3 2 roll dtransform /dy exch def /dx exch def
        cx cy 3 2 roll dtransform /cy exch def /cx exch def
        exch
        %pstack()=
        {
            dup /curcode exch def
            gsave
                1 index /BuildChar get exec
            grestore
            graphicsdict /currgstate get /currfont get
            dup /xadvance get 1 index /yadvance get
            translate
            dx dy translate
            curcode charcode eq {
                cx cy translate
            } if
            %hook
        } forall
        pop
    grestore
    end

    } ifelse
} def

/kshow {
    graphicsdict /currgstate get /currfont get
    dup /FontType get 3 ne { pop //kshow }{
    } ifelse
} def

/stringwidth {
} def

(eof font.ps)print

